#summary Performance issues related to memory budget and input size.
#labels Phase-Design,Featured

= Introduction =

The code was designed to work with a fixed memory budget, regardless of input size.  Sometimes bad compression performance results from an insufficient memory budget.

= Source buffer size =

The encoder uses a buffer for the source input (of size set by the command-line flag -B). To ensure the source input is read sequentially, with no backward seeks, the encoder maintains the source _horizon_ at half the source buffer size ahead of the input position. A source copy will not be found if it lies more than half the source buffer size away from its absolute position in the input stream.

For large files, -B may need to be raised. The default is 64MB.  This means data should not shift more than 32MB, that is, not more than 32MB should be added or removed from the source.

The minimum value of -B is 16KB.

= Input window size =

The input window size (set by -W) determines how much of the input is compressed in a single VCDIFF window.  The default is 256KB.  The minumim value is 16KB, and the maximum value is 16MB.

There is no real benefit to having an especially small or large input window: if it is too small, window overhead will be a problem. If the window becomes very large, addresses begin taking more bits to encode.

= Instruction buffer size =

The instruction buffer saves potential encodings, (possibly) overlapping copy instructions, while it looks ahead in the input. The size of this buffer can be set on the command line via `-I size`, the default is 4096 slots. An unlimited instruction buffer is supported with `-I 0`.

An unencoded instruction occupies 28 bytes, so limiting buffer size does have advantages. On the other hand, the minimum/maximum source address have to be decided before encoding the first instruction, so letting the buffer fill before finishing a window can cause bad compression for the remaining input window.

~~Version 3.0k and earlier used a default of 128 entries.~~  ~~Version 3.0l and earlier did not support `-I`.~~